{
  "annotations": { "list": [] },
  "editable": true,
  "graphTooltip": 1,
  "schemaVersion": 39,
  "tags": ["claude-code"],
  "time": { "from": "now-7d", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Claude Code Team Dashboard",
  "uid": "cc-team-dashboard",
  "templating": {
    "list": [
      {
        "name": "project",
        "label": "Project",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "victoriametrics" },
        "definition": "label_values(claude_code_session_count_total, project_name)",
        "query": "label_values(claude_code_session_count_total, project_name)",
        "includeAll": true,
        "multi": true,
        "allValue": ".*",
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "refresh": 2,
        "sort": 1
      },
      {
        "name": "user",
        "label": "User",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "victoriametrics" },
        "definition": "label_values(claude_code_session_count_total{project_name=~\"$project\"}, user_name)",
        "query": "label_values(claude_code_session_count_total{project_name=~\"$project\"}, user_name)",
        "includeAll": true,
        "multi": true,
        "allValue": ".*",
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "refresh": 2,
        "sort": 1
      }
    ]
  },
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] }, "textMode": "auto" },
      "title": "Sessions",
      "description": "Period total sessions",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(increase(claude_code_session_count_total{user_name=~\"$user\",project_name=~\"$project\"}[$__range]))",
          "legendFormat": "sessions",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "currencyUSD"
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 },
      "id": 2,
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] }, "textMode": "auto" },
      "title": "Total Cost",
      "description": "Estimated API cost",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(increase(claude_code_cost_usage_total{user_name=~\"$user\",project_name=~\"$project\"}[$__range]))",
          "legendFormat": "cost",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "purple", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 1 },
      "id": 3,
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] }, "textMode": "auto" },
      "title": "Total Tokens",
      "description": "Input + output tokens",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(increase(claude_code_token_usage_total{user_name=~\"$user\",project_name=~\"$project\"}[$__range]))",
          "legendFormat": "tokens",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }] },
          "unit": "h"
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 1 },
      "id": 4,
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] }, "textMode": "auto" },
      "title": "Active Time",
      "description": "Total active coding time",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(increase(claude_code_active_time_total_seconds_total{user_name=~\"$user\",project_name=~\"$project\"}[$__range])) / 3600",
          "legendFormat": "hours",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 101,
      "title": "Sessions & Activity",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 5,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Sessions by User",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (user_name) (increase(claude_code_session_count_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{user_name}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "unit": "m"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 6,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Active Time by User",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (user_name) (increase(claude_code_active_time_total_seconds_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval])) / 60",
          "legendFormat": "{{user_name}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "id": 102,
      "title": "Tokens & Cost",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 30,
            "stacking": { "mode": "normal" }
          },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 15 },
      "id": 7,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Token Usage by Type",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (type) (increase(claude_code_token_usage_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 30,
            "stacking": { "mode": "normal" }
          },
          "unit": "currencyUSD"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 15 },
      "id": 8,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Cost by User",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (user_name) (increase(claude_code_cost_usage_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{user_name}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 23 },
      "id": 103,
      "title": "Code Changes",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 24 },
      "id": 9,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Lines of Code (Added / Removed)",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (type) (increase(claude_code_lines_of_code_count_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 24 },
      "id": 10,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Commits & PRs by User",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (user_name) (increase(claude_code_commit_count_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{user_name}} commits",
          "refId": "A"
        },
        {
          "expr": "sum by (user_name) (increase(claude_code_pull_request_count_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{user_name}} PRs",
          "refId": "B"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "id": 14,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Edit/Write Accept vs Reject",
      "description": "Code edit tool decisions (accept/reject) by tool type",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (tool, decision) (increase(claude_code_code_edit_tool_decision_total{user_name=~\"$user\",project_name=~\"$project\"}[$__interval]))",
          "legendFormat": "{{tool}} {{decision}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "victoriametrics" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "id": 15,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Edit/Write Decisions by Language",
      "description": "Code edit decisions broken down by programming language",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (language) (increase(claude_code_code_edit_tool_decision_total{user_name=~\"$user\",project_name=~\"$project\",decision=\"accept\"}[$__interval]))",
          "legendFormat": "{{language}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 40 },
      "id": 104,
      "title": "Tool Usage (Logs)",
      "type": "row"
    },
    {
      "datasource": { "type": "victoriametrics-logs-datasource", "uid": "victorialogs" },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 41 },
      "id": 11,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "title": "Tool Executions",
      "description": "Recent tool_result events showing tool usage. Use LogsQL filters to narrow down.",
      "type": "logs",
      "targets": [
        {
          "expr": "event.name:tool_result",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 51 },
      "id": 105,
      "title": "MCP & Skill Usage (Logs)",
      "type": "row"
    },
    {
      "datasource": { "type": "victoriametrics-logs-datasource", "uid": "victorialogs" },
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 52 },
      "id": 12,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "title": "MCP Server Calls",
      "description": "MCP server invocations (requires OTEL_LOG_TOOL_DETAILS=1)",
      "type": "logs",
      "targets": [
        {
          "expr": "event.name:tool_result AND tool_parameters:mcp_server_name",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "victoriametrics-logs-datasource", "uid": "victorialogs" },
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 52 },
      "id": 13,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "title": "Skill Usage",
      "description": "Skill invocations (requires OTEL_LOG_TOOL_DETAILS=1)",
      "type": "logs",
      "targets": [
        {
          "expr": "event.name:tool_result AND tool_parameters:skill_name",
          "refId": "A"
        }
      ]
    }
  ]
}
